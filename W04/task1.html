<html>
    <head>
        <title>W04_Task 1 : data visualization : Circle : Japan map with population</title>
    </head>
    <body>
	<script src="https://d3js.org/d3.v6.min.js"></script>
	<script>

	 const svg_h = 2000;
	 const svg_w = 2000;

	 let max_lat;
	 let max_lng;
	 let max_pop;

	 let min_lat;
	 let min_lng;
	 let min_pop;

	 var svg = d3.select("body").append("svg")
	 	.attr("width", svg_w)
        .attr("height", svg_h)
		.style("fill","red")
	 ;

	 let init_val = (data) => {
		console.log("start init_val");

		console.log(``+
			`max_lat : ${this.max_lat}\n`+
			`max_lng : ${this.max_lng}\n`+
			`max_pop : ${this.max_pop}\n`+
			`min_lat : ${this.min_lat}\n`+
			`min_lng : ${this.min_lng}\n`+
			`min_pop : ${this.min_pop}\n`
		);

		this.max_lat = data.reduce((a, b) => Math.max(a, b.lat), 0);
		this.max_lng = data.reduce((a, b) => Math.max(a, b.lng), 0);
		this.max_pop = data.reduce((a, b) => Math.max(a, b.population_proper), 0);

		this.min_lat = data.reduce((a, b) => Math.min(a, b.lat), Infinity);
		this.min_lng = data.reduce((a, b) => Math.min(a, b.lng), Infinity);
		this.min_pop = data.reduce((a, b) => Math.min(a, b.population_proper), Infinity);

		console.log(``+
			`max_lat : ${this.max_lat}\n`+
			`max_lng : ${this.max_lng}\n`+
			`max_pop : ${this.max_pop}\n`+
			`min_lat : ${this.min_lat}\n`+
			`min_lng : ${this.min_lng}\n`+
			`min_pop : ${this.min_pop}\n`
		);

		console.log("end init_val");
	 };

	 function draw(data,min_lat,min_lng,min_pop){

		const lat_lng_offset = 20;

		svg.selectAll("circle").data(data)
		.enter()
		.append("circle")
		.attr("cy", function(d){ console.log(`latitude : ${d.lat}`); return svg_h-Math.round((d.lat-min_lat)*1000)/10 + lat_lng_offset; })
		.attr("cx", function(d){ console.log(`longitude : ${d.lng}`);return Math.round((d.lng-min_lng)*1000)/10 + lat_lng_offset; })
		.attr("r", function(d){ console.log(`population : ${d.population_proper}`);return /* Math.round(d.population_proper-min_pop) +*/1; })
	 };

	 d3.csv("https://amfarwati.github.io/InfoVis2024_Farwati/W04/w04_task1.csv")
	 .then((data) => {
		init_val(data);
		draw(data, this.min_lat, this.min_lng, this.min_pop);
	 })
	 .catch((error) => {console.log(error)});

	</script>
    </body>
</html>
